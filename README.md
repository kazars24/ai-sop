# Preview
![image](https://github.com/kazars24/ai-sop/assets/126725121/0d089fb7-0862-42ed-bf0c-5c303e60f33b)
![image](https://github.com/kazars24/ai-sop/assets/126725121/dd876f91-4e52-4ff2-bc2d-fb511f1a7a9a)


# ML System Design Doc 
## Дизайн ML системы - AI S&OP
### 1. Цели и предпосылки
#### 1.1. Зачем идем в разработку продукта?  

- Бизнес-цель: оптимизация в управлении цепями поставок с помощью передовых технологий машинного обучения и интеллектуального анализа данных.
- Почему станет лучше, чем сейчас, от использования ML: использование машинного обучения поможет искать паттерны в данных для более точного прогнозирования, что даст возможность более рационально закупать/производить товар под нужны потребителя.
- Что будем считать успехом итерации с точки зрения бизнеса: повышение оборачиваемости товара, низкий MAPE продаж.
### 1.2. Бизнес-требования и ограничения

#### Краткое описание бизнес-требований и ссылки на детальные документы

AI S&OP (Sales and Operations Planning) система разрабатывается для оптимизации процессов управления цепями поставок, прогнозирования спроса и улучшения принятия решений. Основные цели проекта включают:

- Улучшение точности прогнозирования спроса.
- Оптимизация запасов и минимизация избыточных запасов.
- Повышение эффективности операций в цепи поставок.
- Обеспечение сквозной видимости процесса планирования.


#### Бизнес-ограничения

**Product Owner:**
- Текущие процессы и системы должны интегрироваться с новой системой AI S&OP без значительных изменений.
- Бюджет и ресурсы ограничены, что требует тщательного управления проектом.
- Ограничения по времени на разработку и развертывание системы в зависимости от квартальных и годовых планов компании.
- Данные для обучения модели могут быть ограничены по объему и качеству.
- Система должна соответствовать требованиям безопасности и конфиденциальности данных.

#### Ожидания от конкретной итерации

**Product Owner:**
- Разработка прототипа модели прогнозирования с использованием одного из предложенных методов (Gradient Boosting, Exponential Smoothing, Prophet).
- Тестирование модели на исторических данных для оценки точности прогнозов.
- Интеграция модели с существующими бизнес-процессами для проведения пилотного тестирования.
- Обратная связь от ключевых пользователей и заинтересованных сторон для улучшения модели.

#### Описание бизнес-процесса пилота

**Product Owner:**
- Модель будет интегрирована в текущий процесс планирования спроса и управления запасами.
- Система будет ежедневно генерировать прогнозы спроса, которые будут сравниваться с фактическими данными.
- На основе прогнозов будут приниматься решения по закупкам, производственным планам и распределению запасов.
- Во время пилотного тестирования будут учитываться все замечания и предложения от пользователей для доработки модели.

#### Критерии успешного пилота

**Product Owner:**
- **Точность прогнозов:** Модель должна демонстрировать точность прогнозов на уровне не ниже 70% по сравнению с фактическими данными.
- **Улучшение бизнес-показателей:** Снижение избыточных запасов, уменьшение недостач и повышение уровня обслуживания клиентов.
- **Принимаемость пользователями:** Включение положительных отзывов и высокого уровня удовлетворенности пользователей.
- **Интеграция в бизнес-процесс:** Успешная интеграция модели в текущие процессы без значительных задержек или дополнительных затрат.

**Возможные пути развития проекта:**
- Расширение модели для учета сезонных и рыночных колебаний.
- Внедрение системы в другие подразделения компании или на другие рынки.
- Автоматизация процесса обновления модели с учетом новых данных.
- Постоянная оптимизация модели на основе новых данных и обратной связи пользователей.



### 1.3. Предпосылки решения

#### Описание общих предпосылок решения

1. **Исходные данные и их блоки**
   - **Исторические данные о продажах:** Ежедневные/еженедельные данные о продажах по различным товарным категориям за последние 2-3 года.
   - **Данные о запасах:** Информация о текущих и исторических уровнях запасов на складах.
   - **Данные о промоакциях и маркетинговых кампаниях:** Включают информацию о проведенных маркетинговых акциях, скидках и их влиянии на продажи.
   - **Внешние данные:** Макроэкономические показатели, данные о погоде, сезонности и других факторах, которые могут влиять на спрос.

2. **Горизонт прогноза**
   - Прогнозирование осуществляется на краткосрочный период (1-3 месяца) и среднесрочный период (4-12 месяцев), в зависимости от потребностей бизнеса.
   - Краткосрочный прогноз используется для оперативного управления запасами и планирования производства.
   - Среднесрочный прогноз помогает в стратегическом планировании и управлении цепями поставок.

3. **Гранулярность модели**
   - **Временная гранулярность:** Ежедневные прогнозы для краткосрочного периода и еженедельные прогнозы для среднесрочного периода.
   - **Пространственная гранулярность:** Прогнозы на уровне отдельных магазинов, регионов или складов в зависимости от доступности и качества данных.
   - **Категориальная гранулярность:** Прогнозы по ключевым категориям товаров (алкоголь, аксессуары и т.д.), а также по отдельным продуктам, если это необходимо и позволяет объем данных.

4. **Предпосылки, связанные с архитектурой и алгоритмами**
   - **Алгоритмы машинного обучения:** Использование моделей временных рядов, таких как SARIMA, Prophet, или обобщённые модели, такие как XGBoost или LSTM, в зависимости от характера данных и потребностей бизнеса.
   - **Обоснование выбора алгоритмов:** 
     - SARIMA и Prophet хорошо справляются с прогнозированием временных рядов с сезонностью и трендами.
     - XGBoost и LSTM могут учитывать нелинейные зависимости и сложные взаимодействия между переменными.
   - **Периодический пересмотр и обновление моделей:** Модель должна быть переобучаема с новой порцией данных ежемесячно или ежеквартально.

5. **Интеграция и масштабируемость**
   - **Интеграция с текущими системами:** Решение должно легко интегрироваться с существующими системами ERP и CRM для автоматизации процессов.
   - **Масштабируемость:** Система должна быть построена таким образом, чтобы поддерживать добавление новых источников данных и возможность масштабирования на другие подразделения или рынки.  

### 2. Методология `Data Scientist`     

### 2.1. Постановка задачи

В данной секции описывается, что конкретно мы будем делать с технической точки зрения в рамках системы AI S&OP.

#### Основные технические задачи

1. **Прогнозирование спроса**
   - **Цель:** Разработать модель прогнозирования спроса на различные товарные категории и отдельные продукты на краткосрочный и среднесрочный периоды.
   - **Технические детали:**
     - Использование алгоритмов машинного обучения для анализа временных рядов (например, SARIMA, Prophet, LSTM).
     - Интеграция сезонных и трендовых компонентов для повышения точности прогнозов.
     - Обработанные прогнозы будут использоваться для планирования закупок, производства и распределения товаров.

2. **Поиск аномалий**
   - **Цель:** Создать систему для обнаружения аномалий в данных о продажах, запасах и поставках.
   - **Технические детали:**
     - Применение моделей для обнаружения выбросов и аномалий (например, Isolation Forest, DBSCAN).
     - Анализ аномальных паттернов для выявления проблем в цепи поставок и предложений по решению.
     - Автоматическая генерация оповещений для операторов при выявлении аномалий.

3. **Оптимизация запасов**
   - **Цель:** Разработать алгоритмы для оптимизации уровней запасов на складах и распределительных центрах.
   - **Технические детали:**
     - Моделирование и оценка текущих уровней запасов и потребностей с использованием методов оптимизации (например, линейное программирование, методы Монте-Карло).
     - Предложение стратегий по минимизации избыточных запасов и предотвращению дефицита товаров.
     - Учет факторов сезонности, промоакций и других внешних факторов, влияющих на спрос.

#### Дополнительные технические задачи

1. **Интеграция со сторонними системами**
   - Обеспечение совместимости и интеграции с существующими ERP и CRM системами для автоматизации всех процессов.

2. **Периодическое обновление моделей**
   - Настройка автоматического обновления и пересмотра моделей на основе новых данных и трендов.

3. **Мониторинг и отчетность**
   - Создание дашбордов и отчетов для визуализации прогностических данных и обнаруженных аномалий, а также для отслеживания эффективности внедренных оптимизаций.

4. **Безопасность данных**
   - Убедиться, что все данные, используемые и генерируемые системой, защищены и соответствуют стандартам конфиденциальности и безопасности.

#### 2.2. Блок-схема решения  

[Ссылка на блок-схему и этапы решения](https://miro.com/app/board/uxjvnmkkbkk=/)  
  
### 3. Подготовка пилота  
  
### 3.1. Способ оценки пилота

Для оценки пилота планируется использовать A/B тестирование с контрольной и экспериментальной группами. 

#### Краткое описание предполагаемого дизайна и способа оценки пилота:

1. **Дизайн пилота:**
   - **Контрольная группа:** Будет управляться с использованием текущих методов прогнозирования и управления запасами.
   - **Экспериментальная группа:** Будет управляться с использованием новой системы AI S&OP.

2. **Сегментация:**
   - Группы текущих клиентов, магазинов или складов будут случайным образом распределены между контрольной и экспериментальной группами.

3. **Период проведения пилота:**
   - Продолжительность пилота запланирована на 3 месяца для сборки достаточного объема данных для анализа.

4. **Сбор данных:**
   - Все данные будут собираться и анализироваться в реальном времени с использованием статистических методов для определения значимости.

### 3.2. Что считаем успешным пилотом

Формализованные метрики оценки успешности пилота:

1. **Точность прогнозов:**
   - Метрика: Mean Absolute Percentage Error (MAPE)
   - Уровень успешности: Понижение MAPE на 10% по сравнению с контрольной группой.

2. **Уровень сервиса (Service Level):**
   - Метрика: Доля заказов, выполненных без задержек и с полным ассортиментом.
   - Уровень успешности: Повышение уровня сервиса на 5%.

3. **Оптимизация запасов:**
   - Метрика: Уменьшение избыточных запасов (% от общего запаса).
   - Уровень успешности: Снижение избыточных запасов на 10%.

4. **Обнаружение аномалий:**
   - Метрика: Количество правильно обнаруженных и вручную проверенных аномалий.
   - Уровень успешности: 95% точность обнаружения аномалий.
     
5. **Финансовые показатели:**
   - Метрика: Общая экономия затрат, оборачиваемость товара.
   - Уровень успешности: Экономия на уровнях запасов и стоимостьх логистики в размере 5%.

### 3.3. Подготовка пилота

Описание того, что можем позволить себе, исходя из ожидаемых затрат на вычисления:

1. **Оценка вычислительных мощностей:**
   - Первоначально будет проведён этап расчетов ожидаемой вычислительной сложности на экспериментальном сегменте с использованием бейзлайновой модели.
   - Будет рассмотрено использование облачных решений для масштабирования, таких как AWS или Google Cloud Platform.
   - Оценка стоимости вычислений на основе используемых алгоритмов и объемов данных.

2. **Предусмотрение ограничений:**
   - На этапе подготовки пилота будут установлены лимиты вычислительных ресурсов, например, максимальное количество процессорных часов или объем используемой памяти.
   - Уточнение параметров пилотного проекта, таких как частота обновления моделей и глубина анализа данных, чтобы придерживаться заданных ограничений.
   - При обнаружении превышения вычислительных лимитов предусмотрена возможность настройки параметров, таких как уменьшение частоты обновления, уменьшение объема анализируемых данных или выбор менее ресурсоёмких алгоритмов.

3. **Процедуры мониторинга и управления:**
   - Внедрение системы мониторинга использования вычислительных ресурсов и производительности моделей в реальном времени.
   - Настройка автоматических уведомлений при достижении установленных лимитов по вычислительным ресурсам.

# Setup
1. Install Ollama
2. Pull the desired LLM and vision-LLM using `ollama pull <model_name>:<tag>`.

Recommended context size: `128k+.`

Recommended LLM: `Phi-3-medium-128k`

Recommended vision LLM: `LLaVA-Phi-3-small`

3. Install dependencies:
```
pip install -U poetry==1.7.1
poetry install --sync --no-root
poetry run pre-commit install
poetry run pre-commit autoupdate
```
